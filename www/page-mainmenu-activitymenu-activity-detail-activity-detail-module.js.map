{"version":3,"sources":["webpack:///./src/app/page/mainmenu/activitymenu/activity-detail/activity-detail.module.ts","webpack:///./src/app/page/mainmenu/activitymenu/activity-detail/activity-detail.page.html","webpack:///./src/app/page/mainmenu/activitymenu/activity-detail/activity-detail.page.scss","webpack:///./src/app/page/mainmenu/activitymenu/activity-detail/activity-detail.page.ts"],"names":[],"mappings":"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","file":"page-mainmenu-activitymenu-activity-detail-activity-detail-module.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\nimport { ComponentModule } from '../../../../component/component.module';\nimport { ActivityDetailPage } from './activity-detail.page';\nimport { ModalModule } from 'src/app/page/modal/modal.module';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: ActivityDetailPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    ComponentModule,\n    ModalModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [ActivityDetailPage],\n})\nexport class ActivityDetailPageModule {}\n","module.exports = \"<ion-header no-border>\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-back-button color=\\\"navback\\\"></ion-back-button>\\n    </ion-buttons>\\n    <!-- <ion-icon color=\\\"navback\\\" slot=\\\"start\\\" name=\\\"arrow-back\\\" (click)=\\\"onClickBackBtn()\\\"></ion-icon> -->\\n    <ion-title>{{boardInfo?.title}}</ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content padding>\\n  <div id=\\\"activity-detail-board-imgs\\\">\\n    <ng-container *ngIf=\\\"boardInfo?.imgs.length > 0; else noBoardImage\\\">\\n      <div id=\\\"activity-detail-board-img-container\\\">\\n        <img [src]=\\\"boardInfo?.imgs[0]\\\" />\\n      </div>\\n    </ng-container>\\n    <ng-template #noBoardImage>\\n      <p>\\n        No Image\\n      </p>\\n    </ng-template>\\n  </div>\\n\\n  <div id=\\\"activity-detail-message-container\\\">\\n    <ng-container *ngFor=\\\"let message of detailMessages\\\">\\n      <messagebox [message]=\\\"message\\\" [currentUser]=\\\"currentUserInfo.uid\\\" [isDisableProfileClick]=\\\"true\\\"></messagebox>\\n    </ng-container>\\n  </div>\\n</ion-content>\\n\\n<ion-footer>\\n  <ion-toolbar>\\n    <ion-item>\\n      <ion-input type=\\\"text\\\" [(ngModel)]=\\\"messageTxt\\\" placeholder=\\\"Your Message\\\"></ion-input>\\n      <ion-icon slot=\\\"end\\\" name=\\\"mail\\\" (click)=\\\"sendMessage()\\\"></ion-icon>\\n    </ion-item>\\n  </ion-toolbar>\\n</ion-footer>\\n\"","module.exports = \"ion-header {\\n  --ion-background-color: #84A1B3; }\\n  ion-header ion-toolbar {\\n    --background: #84A1B3; }\\n  ion-header ion-toolbar ion-icon {\\n      font-size: 16pt;\\n      margin-left: 16px; }\\n  ion-header ion-toolbar ion-title {\\n      position: absolute;\\n      left: 50%;\\n      top: 50%;\\n      transform: translate(-50%, -50%);\\n      color: #CAE9F7; }\\n  #activity-detail-board-imgs {\\n  text-align: center; }\\n  #activity-detail-board-img-container {\\n  height: 100px;\\n  overflow: hidden;\\n  position: relative;\\n  margin: 2vh 0 3vh 0; }\\n  #activity-detail-board-img-container img {\\n    position: absolute;\\n    top: 50%;\\n    left: 50%;\\n    transform: translate(-50%, -50%);\\n    max-width: 100px; }\\n\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvcGFnZS9tYWlubWVudS9hY3Rpdml0eW1lbnUvYWN0aXZpdHktZGV0YWlsL0U6XFx3b3Jrc3BhY2VcXEFuZHJvaWRcXGxpbmV1cCgwOS0xOCkvc3JjXFxhcHBcXHBhZ2VcXG1haW5tZW51XFxhY3Rpdml0eW1lbnVcXGFjdGl2aXR5LWRldGFpbFxcYWN0aXZpdHktZGV0YWlsLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNJLCtCQUF1QixFQUFBO0VBRDNCO0lBR1EscUJBQWEsRUFBQTtFQUhyQjtNQUtZLGVBQWU7TUFDZixpQkFBaUIsRUFBQTtFQU43QjtNQVNZLGtCQUFrQjtNQUNsQixTQUFTO01BQ1QsUUFBUTtNQUNSLGdDQUFnQztNQUNoQyxjQUFjLEVBQUE7RUFLMUI7RUFDSSxrQkFBa0IsRUFBQTtFQUd0QjtFQUNJLGFBQWE7RUFDYixnQkFBZ0I7RUFDaEIsa0JBQWtCO0VBQ2xCLG1CQUFtQixFQUFBO0VBSnZCO0lBTVEsa0JBQWtCO0lBQ2xCLFFBQVE7SUFDUixTQUFTO0lBQ1QsZ0NBQWdDO0lBQ2hDLGdCQUFnQixFQUFBIiwiZmlsZSI6InNyYy9hcHAvcGFnZS9tYWlubWVudS9hY3Rpdml0eW1lbnUvYWN0aXZpdHktZGV0YWlsL2FjdGl2aXR5LWRldGFpbC5wYWdlLnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyJpb24taGVhZGVyIHtcbiAgICAtLWlvbi1iYWNrZ3JvdW5kLWNvbG9yOiAjODRBMUIzO1xuICAgIGlvbi10b29sYmFyIHtcbiAgICAgICAgLS1iYWNrZ3JvdW5kOiAjODRBMUIzO1xuICAgICAgICBpb24taWNvbiB7XG4gICAgICAgICAgICBmb250LXNpemU6IDE2cHQ7XG4gICAgICAgICAgICBtYXJnaW4tbGVmdDogMTZweDtcbiAgICAgICAgfVxuICAgICAgICBpb24tdGl0bGUge1xuICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICAgICAgbGVmdDogNTAlO1xuICAgICAgICAgICAgdG9wOiA1MCU7XG4gICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTtcbiAgICAgICAgICAgIGNvbG9yOiAjQ0FFOUY3O1xuICAgICAgICB9XG4gICAgfVxufVxuXG4jYWN0aXZpdHktZGV0YWlsLWJvYXJkLWltZ3Mge1xuICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbn1cblxuI2FjdGl2aXR5LWRldGFpbC1ib2FyZC1pbWctY29udGFpbmVyIHtcbiAgICBoZWlnaHQ6IDEwMHB4O1xuICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgIG1hcmdpbjogMnZoIDAgM3ZoIDA7XG4gICAgaW1nIHtcbiAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICB0b3A6IDUwJTtcbiAgICAgICAgbGVmdDogNTAlO1xuICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTtcbiAgICAgICAgbWF4LXdpZHRoOiAxMDBweDtcbiAgICB9XG59Il19 */\"","import { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { LoadingController } from '@ionic/angular';\nimport * as firebase from 'firebase/app';\n\nimport { Message, UserData } from '../../../interface/interface';\nimport { FirebaseService } from 'src/app/services/firebase-service/firebase.service';\nimport { MyutilsService } from 'src/app/services/myutils/myutils.service';\n\n@Component({\n  selector: 'app-activity-detail',\n  templateUrl: './activity-detail.page.html',\n  styleUrls: ['./activity-detail.page.scss'],\n})\nexport class ActivityDetailPage implements OnInit {\n\n  private detailMessages: Message[];\n  private boardInfo: any = null;\n  private itemId = '';\n  private chatUserId: string;\n  private chatDataRef = null;\n  private chatDataListener = null;\n\n  private currentUserInfo: UserData = {};\n  private messageTxt = '';\n  private chatRoom = '';\n\n  constructor(\n    private router: Router,\n    private route: ActivatedRoute,\n    private firebaseService: FirebaseService,\n    private myUtils: MyutilsService,\n    private loadingCtrl: LoadingController,\n  ) {\n    this.detailMessages = [];\n  }\n\n  ngOnInit() {}\n\n  ionViewWillEnter() {\n    this.initPage();\n  }\n\n  async initPage() {\n    this.itemId = this.route.snapshot.paramMap.get('itemid');\n    this.chatUserId = this.route.snapshot.paramMap.get('poster');\n    await this.getChatHistory();\n  }\n\n  async getChatHistory() {\n    const messageLoader = await this.loadingCtrl.create({\n      message: 'Loading...'\n    });\n    await messageLoader.present();\n\n    const cuid = this.firebaseService.getUID();\n    const userProfileSnapshot = await this.firebaseService.getUserProfile(cuid);\n    this.currentUserInfo = userProfileSnapshot.val();\n\n\n    if (cuid >= this.chatUserId) {\n      this.chatRoom = this.chatUserId + '-' + cuid;\n    } else {\n      this.chatRoom = cuid + '-' + this.chatUserId;\n    }\n    console.log(cuid, this.chatUserId, this.chatRoom);\n    const self = this;\n\n    /**\n     * Get Current Board Info\n     */\n\n    try {\n      const boardInfoSnapshot = await this.firebaseService.getSpecificBoardInfo(this.itemId);\n      this.boardInfo = boardInfoSnapshot.val();\n    } catch (err) {\n      messageLoader.dismiss();\n      console.log(err);\n    }\n\n    this.chatDataRef = this.firebaseService.getMessageDataRef(this.itemId, this.chatRoom);\n    this.chatDataListener = this.chatDataRef.on('value', snapshot => {\n      self.detailMessages = [];\n      snapshot.forEach(function(chidlsnapshot) {\n        self.detailMessages.push({...chidlsnapshot.val()});\n      });\n      if (messageLoader !== null) {\n        messageLoader.dismiss();\n      }\n    });\n  }\n\n  onClickBoardImage() {\n    this.clearDataListener();\n    localStorage.setItem('posterid', this.chatUserId);\n    this.router.navigateByUrl('/shopitemdetail/' + this.itemId + '/chat');\n  }\n\n  sendMessage() {\n    if (this.messageTxt !== '') {\n      const messageItem = {\n        uid: this.firebaseService.getUID(),\n        name: this.currentUserInfo.fname + ' ' + this.currentUserInfo.lname,\n        photo: '',\n        content: this.messageTxt,\n        time: firebase.database.ServerValue.TIMESTAMP,\n        contentimg: this.boardInfo.imgs[0],\n        boardName: this.boardInfo.title,\n        isRead: false,\n        location: {\n          lat: this.myUtils.currentUserLocation.lat,\n          long: this.myUtils.currentUserLocation.long\n        },\n        review: 0\n      };\n\n      this.firebaseService.sendMessage(this.itemId, this.chatRoom, messageItem);\n      this.messageTxt = '';\n    }\n  }\n\n  clearDataListener() {\n    if (this.chatDataListener !== null) {\n      this.chatDataRef.off('value', this.chatDataListener);\n      this.chatDataListener = null;\n      this.chatDataRef = null;\n    }\n  }\n\n  onClickBackBtn() {\n    this.clearDataListener();\n    this.router.navigateByUrl('/home/activity');\n  }\n\n}\n"],"sourceRoot":""}